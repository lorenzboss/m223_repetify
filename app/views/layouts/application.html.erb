<!-- app/views/layouts/application.html.erb -->
<!DOCTYPE html>
<html lang="de">
<head>
  <title>Repetify - Learn words. Keep them forever.</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <meta name="description" content="Repetify ist die beste App zum Vokabeln lernen und behalten, entwickelt von Lorenz Boss.">
  <meta name="keywords" content="Lorenz Boss, Vokabeln lernen, Sprachen lernen, Repetify, Deutsch, Englisch, Französisch, kostenlos, App, Bildung, Wortschatz, Wiederholung, Lernen, Schule, Schüler, Lehrer, Vokabeltrainer">
  <meta name="author" content="Lorenz Boss">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <!-- Bootstrap CSS via CDN with SRI -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous">

  <!-- Bootstrap Icons via CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"
        rel="stylesheet">

  <!-- Custom CSS (after Bootstrap so it can override) -->
  <%= stylesheet_link_tag "app", "data-turbo-track": "reload" %>

  <!-- Rails JS (Turbo, Importmap) -->
  <%= javascript_importmap_tags %>

  <!-- Favicon and Touch Icons -->
  <link rel="icon" type="image/svg+xml" href="/icon.svg">
  <link rel="apple-touch-icon" sizes="500x500" href="/icon.png">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow">
  <div class="container ">
    <%= link_to root_path, class: "navbar-brand fw-bold mb-0" do %>
      <i class="bi bi-book me-2"></i>Repetify
    <% end %>
    <% if user_signed_in? %>
      <div class="d-flex align-items-center gap-3">
        <span class="navbar-text d-none d-md-inline ">
          <i class="bi bi-person-circle"></i>
          <%= current_user.email %>
        </span>
        <% if current_user.admin? %>
          <%= link_to admin_index_path, class: "btn btn-outline-light btn-sm" do %>
            <i class="bi bi-shield-check me-sm-1"></i><span class="d-none d-sm-inline">Admin</span>
          <% end %>
        <% end %>
        <%= link_to destroy_user_session_path,
          method: :delete,
          class: "btn btn-outline-light btn-sm logout-btn",
          data: {
            confirm: "Möchtest du dich wirklich abmelden?",
            turbo_method: :delete
          } do %>
          <i class="bi bi-box-arrow-right me-sm-1"></i><span class="d-none d-sm-inline">Abmelden</span>
        <% end %>
      </div>
    <% end %>
  </div>
</nav>

<main>
  <!-- Flash Messages als Toasts -->
  <% if notice %>
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
      <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000">
        <div class="toast-header bg-success text-white">
          <i class="bi bi-check-circle me-2"></i>
          <strong class="me-auto">Erfolgreich</strong>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
          <%= notice %>
        </div>
      </div>
    </div>
  <% end %>

  <% if alert %>
    <% if alert == "You need to sign in or sign up before continuing." %>
      <!-- Toast für unauthenticated Meldung -->
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000">
          <div class="toast-header bg-warning text-dark">
            <i class="bi bi-shield-lock me-2"></i>
            <strong class="me-auto">Anmeldung erforderlich</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
          </div>
          <div class="toast-body">
            Bitte melde dich an, um fortzufahren.
          </div>
        </div>
      </div>
    <% else %>
      <!-- Toast für normale Fehlermeldungen -->
      <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055;">
        <div class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-autohide="true" data-bs-delay="3000">
          <div class="toast-header bg-danger text-white">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <strong class="me-auto">Fehler</strong>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="toast"></button>
          </div>
          <div class="toast-body">
            <%= alert %>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>

  <%= yield %>
</main>

<!-- Footer -->
<footer class="bg-dark text-light py-4 mt-5">
  <div class="container text-center">
    <small>
      <i class="bi bi-translate me-1"></i>
      Repetify - Learn words. Keep them forever.
    </small>
  </div>
</footer>

<!-- Bootstrap JS via CDN with SRI (before closing body tag) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>

<!-- JavaScript für automatisches Verschwinden von Toasts -->
<script>
    // Funktion zum Initialisieren der Toasts
    function initializeToasts() {
        // Finde alle Toasts und initialisiere sie
        var toastElements = document.querySelectorAll('.toast');
        toastElements.forEach(function (toastEl) {
            var toast = new bootstrap.Toast(toastEl, {
                autohide: true,
                delay: 4000  // 4 Sekunden für bessere Lesbarkeit
            });

            // Starte den Toast automatisch
            toast.show();
        });
    }

    // Beim ersten Laden der Seite
    document.addEventListener('DOMContentLoaded', initializeToasts);

    // Nach Turbo-Navigation (für Redirects)
    document.addEventListener('turbo:load', initializeToasts);
</script>
</body>
</html>
